<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>3_CastleBreakIn</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
  .typora-export h1::after, .typora-export h2::after, .typora-export h3::after, .typora-export h4::after, .typora-export h5::after, .typora-export h6::after { content: ""; display: block; height: 100px; margin-bottom: -100px; }
}


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        border-top: 1px solid #eee;
        margin-top: .3em;
    }
}

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table tr td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export os-windows'>
<div id='write'  class=''><h1><a name="castle-break-in-part-1" class="md-header-anchor"></a><span>Castle Break-In, Part 1</span></h1><p><span>After his duel with Marcus, the mysterious stranger flees. Pursued by Princess Ann, he hides in a spooky castle and seals the entrance with magic.</span></p><p><span>The magic stones block Ann&#39;s path, but a sharp impact will destroy them. Thinking quickly, Ann grabs her souvenir East Alexandria soccer ball. Using the incredible header skills she learned as captain of the royal soccer team, she attempts to make her way inside the castle&#39;s walls.</span></p><p><span>In your workspace, you should see some image files for a castle, a wall, a ball sheet, a princess sheet, and some blocks.  There is also a </span><code>grass.png</code><span> file we will be using for the background.  </span></p><h2><a name="setting-up-the-game-play-area" class="md-header-anchor"></a><span>Setting up the game play area</span></h2><p><span>As a test of your of your JavaScript fluency, see if you can perform these tasks without looking back at previous tutorials.  Of course, feel free to copy your previous code if you get stuck!</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Import </span><code>game</code><span> and </span><code>Sprite</code><span> modules from &quot;./sgc/sgc.js&quot; .</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Set the background to &quot;grass.png&quot; using the </span><code>game</code><span> object&#39;s </span><code>setBackground()</code><span> method.</span></p></li></ul><p><span>In the Stranger Hunt tutorial we created four wall objects directly from the </span><code>Sprite</code><span> class and set their properties individually in four blocks of code that looked almost identical to each other. Reimplementing repeated code over and over again isnâ€™t ideal programming.  If there is a problem in one of the code blocks, there is often a problem in all of them, which complicates the task of trouble-shooting or modifying your code.  Better is to remove duplication by writing a component of some kind (method, class, etc.), and </span><em><span>reusing</span></em><span> it as many times as we like.  Let&#39;s use the power of the class </span><code>constructor()</code><span> method to reuse a block of code and automate this process for us.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a class called </span><code>Wall</code><span> that is a child of the parent class </span><code>Sprite</code><span>.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a </span><code>constructor()</code><span> method of the </span><code>Wall</code><span> class that accepts </span><code>x</code><span> , </span><code>y</code><span>, </span><code>name</code><span> and </span><code>image</code><span> arguments like this:</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">constructor</span>(<span class="cm-variable">x</span>, <span class="cm-variable">y</span>, <span class="cm-variable">name</span>, <span class="cm-variable">image</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the constructor method of the </span><code>Wall</code><span> class:</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Call the parent class constructor method.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Set this object&#39;s x and y coordinates to </span><code>x</code><span> and </span><code>y</code><span> respectively.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Set this object&#39;s name to </span><code>name</code><span>.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Set the image of this object to the </span><code>image</code><span> variable using the </span><code>setImage()</code><span> method.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Set this object&#39;s </span><code>accelerateOnBounce</code><span> property to </span><code>false</code><span>.</span></p></li></ul></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create an </span><em><span>anonymous</span></em><span> object in the </span><code>Wall</code><span> class, passing the coordinates (x, y) = (0, 0), &quot;A spooky castle wall&quot; as the name, and &quot;castle.png&quot; as the image to the constructor of the class like this:</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">new Wall(0, 0, "A spooky castle wall", "castle.png");</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>It is called an anonymous object because we didn&#39;t &quot;name it&quot; by assigning it to a variable.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create a [named] object called </span><code>leftWall</code><span> from the </span><code>Wall</code><span> class, using</span></p><ul><li><span>0 and 200 for </span><code>x</code><span> and </span><code>y</code><span> respectively</span></li><li><span>&quot;Left side wall&quot; for the name</span></li><li><span>&quot;wall.png&quot; for the image</span></li></ul></li></ul><p><span>(HINT: pass these values to the constructor of the class as above)</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create an object called </span><code>rightWall</code><span> from the </span><code>Wall</code><span> class, using</span></p><ul><li><span>game.displayWidth - 48 for </span><code>x</code><span> and 200 for </span><code>y</code></li><li><span>&quot;Right side wall&quot; for the name</span></li><li><span>&quot;wall.png&quot; for the image</span></li></ul></li></ul><p><span>You should now have a grassy game play area that is enclosed by solid objects on all sides, except for the bottom.  This process you just completed, of generalizing left, right, and top walls into a </span><code>Wall</code><span> class that serves for all of them is a form of </span><em><span>abstraction</span></em><span> -- one of the 4 pillars of Object-Oriented Programming (the others are Encapsulation, Inheritance and Polymorphism).</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run the game to check the layout.</span></p></li></ul><h2><a name="adding-the-player-character" class="md-header-anchor"></a><span>Adding the player character</span></h2><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a </span><code>Princess</code><span> class that is a child of the </span><code>Sprite</code><span> class.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a </span><code>constructor()</code><span> method of the </span><code>Princess</code><span> class that accepts no arguments and does the following:</span></p><ul><li><span>Calls the parent class constructor</span></li><li><span>Sets the name to &quot;Princess Ann&quot;</span></li><li><span>Uses the &quot;ann.png&quot; image in the </span><code>setImage()</code><span> method</span></li><li><span>Sets height and width to 48</span></li><li><span>Sets the </span><code>x</code><span> coordinate to the middle of the display area. (HINT: use </span><code>game.displayWidth</code><span>)</span></li><li><span>Sets the </span><code>y</code><span> coordinate to </span><code>this.height</code><span> less than the display height (HINT: use </span><code>game.displayHeight</code><span>)</span></li><li><span>Set a custom property called </span><code>speedWhenWalking</code><span> equal to 150.</span></li><li><span>Set the </span><code>accelerateOnBounce</code><span> property to </span><code>false</code><span>.</span></li><li><span>Define </span><code>left</code><span> and </span><code>right</code><span> animations that use frames 9-11 and 3-5 respectively.</span></li></ul></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create an </span><code>ann</code><span> object from the </span><code>Princess</code><span> class you just defined.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run the game to verify that Princess Ann appears horizontally centered in the play area, with her feet touching the bottom edge of the window.</span></p></li></ul><h3><a name="move-her-around" class="md-header-anchor"></a><span>Move her around</span></h3><p><span>The Princess will move left and right using arrow keys.  Add the following to your </span><code>Princess</code><span> class definition:</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Program the navigation using Marcus&#39;s navigation from Wizards&#39; Duel as a model. You will need to define </span><code>handleLeftArrowKey()</code><span> and </span><code>handleRightArrowKey()</code><span> methods that play the appropriate animations, set the angle to 0 or 180, and the speed of the object to </span><code>this.speedWhenWalking</code><span>.</span></p></li></ul><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run your game and test that you can move Princess Ann back and forth across the screen.</span></p></li></ul><p><span>At this point, the princess can walk through the walls and off screen. That probably shouldn&#39;t be allowed.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Implement your fix, and test it. Be sure that it is working correctly before you move on.</span></p></li></ul><h2><a name="adding-the-soccer-ball" class="md-header-anchor"></a><span>Adding the soccer ball</span></h2><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a class called </span><code>Ball</code><span> that is a child of the </span><code>Sprite</code><span> class.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a </span><code>constructor()</code><span> method of the </span><code>Ball</code><span> class that does the following:</span></p><ul><li><span>Calls the parent class constructor.  Have you noticed that whenever we have a constructor method in a derived class, we </span><em><span>always</span></em><span> have to call the parent class constructor?  Great, from now on I will stop reminding you to include </span><code>super()</code><span>.</span></li><li><span>Sets the </span><code>x</code><span> and </span><code>y</code><span> coordinates so that it is horizontally and vertically centered in the window.</span></li><li><span>Sets the </span><code>height</code><span> and </span><code>width</code><span> to 48.</span></li><li><span>Gives it an appropriate name and image sheet.</span></li><li><span>Defines an animation called &quot;spin&quot; that uses all 12 frames, and then plays that animation repeatedly (so add </span><code>true</code><span> as in </span><code>this.playAnimation(&quot;spin&quot;, true)</code><span>).</span></li><li><span>Sets the </span><code>speed</code><span> property equal to 1.</span></li><li><span>Sets the </span><code>angle</code><span> property to </span><code>50 + Math.random() * 80</code><span>.</span></li></ul></li></ul><p><span>This will make the ball move at an angle of 50 to 130 degrees, or in a generally &quot;upward&quot; direction.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create an </span><strong><span>anonymous</span></strong><span> instance of the </span><code>Ball</code><span> class.  (HINT: you did this previously with the spooky castle wall)</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run your game and test that a ball appears in the middle of the screen and spins around. </span></p></li></ul><p><span>It is moving one pixel per second at this point -- probably not fast enough for you to notice -- and floating in mid-air.  Let&#39;s add some physics to make the ball&#39;s motion appear more natural.</span></p><p><span>It is commonly assumed that an object in freefall increases its speed by a fixed amount every second until it reaches terminal velocity, at which point air resistance balances the gravitational force and the object stops accelerating.  We can roughly recreate that by incrementing the ball&#39;s speed by a fixed amount every game loop, up to a certain maximum speed, using trial and error to set the increment and maximum speed until it is fast enough to be interesting and slow enough to be playable.  A speed increment of 2, and a maximum of 200 seems to work pretty well, but feel free to experiment.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a </span><code>handleGameLoop()</code><span> method for the </span><code>Ball</code><span> class that increments </span><code>this.speed</code><span> by 2 every game loop </span><em><span>if</span></em><span> the speed is less than 200.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run the game and test that the ball starts in a random, generally upward direction and accelerates in a somewhat realistic yet playable way.</span></p></li></ul><h2><a name="the-header-skill-game" class="md-header-anchor"></a><span>The header &quot;skill game&quot;</span></h2><p><span>The default collision handler for sprites is to bounce off, like a wall (angle of incidence equals angle of reflection), but Ann&#39;s header skill allows her more precise control of the bounce direction.  We will simulate this by </span><em><span>overriding</span></em><span> the default </span><code>handleCollision()</code><span> method and adjusting the angle based on the horizontal offset between the center of the ball and the center of Ann&#39;s head.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Inside the </span><code>Princess</code><span> class definition, define a </span><code>handleCollision()</code><span> method as follows:</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">handleCollision</span>(<span class="cm-variable">otherSprite</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Horizontally, Ann's image file is about one-third blank, one-third Ann, and <span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span> &nbsp; // one-third blank.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// Vertically, there is very little blank space. Ann's head is about one-fourth <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tab" role="presentation" cm-text="	">    </span>// the height.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// The other sprite (Ball) should change angle if:</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 1. it hits the middle horizontal third of the image, which is not blank, AND</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// 2. it hits the upper fourth, which is Ann's head.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">let</span> <span class="cm-def">horizontalOffset</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">x</span> <span class="cm-operator">-</span> <span class="cm-variable">otherSprite</span>.<span class="cm-property">x</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">let</span> <span class="cm-def">verticalOffset</span> <span class="cm-operator">=</span> <span class="cm-keyword">this</span>.<span class="cm-property">y</span> <span class="cm-operator">-</span> <span class="cm-variable">otherSprite</span>.<span class="cm-property">y</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> (<span class="cm-variable">Math</span>.<span class="cm-property">abs</span>(<span class="cm-variable-2">horizontalOffset</span>) <span class="cm-operator">&lt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">width</span> <span class="cm-operator">/</span> <span class="cm-number">3</span> </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-operator">&amp;&amp;</span> <span class="cm-variable-2">verticalOffset</span> <span class="cm-operator">&gt;</span> <span class="cm-keyword">this</span>.<span class="cm-property">height</span> <span class="cm-operator">/</span> <span class="cm-number">4</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-comment">// The new angle depends on the horizontal difference between sprites.</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">otherSprite</span>.<span class="cm-property">angle</span> <span class="cm-operator">=</span> <span class="cm-number">90</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> <span class="cm-operator">*</span> <span class="cm-variable-2">horizontalOffset</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-atom">false</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 391px;"></div><div class="CodeMirror-gutters" style="display: none; height: 391px;"></div></div></div></pre><p><span>The last expression is a formula for calculating the ball&#39;s bounce angle. If the ball and Ann&#39;s head are perfectly aligned, the horizontal offset is zero, so the bounce angle is 90 degrees: straight up. If the difference is not zero, it will adjust the base angle of 90 to reflect the horizontal offset of the collision.</span></p><p><span>The princess should now be able to play a game of &quot;keepy uppy&quot; by heading the ball each time that gravity brings it to her level. The ball should bounce against the walls and castle.  If she misses, it will leave the room at the bottom.</span></p><p><span>We still need to clean up after ourselves when the ball leaves play (i.e. remove the sprite) and add some magic blocks for her to destroy with the soccer ball. It would also be nice if she got a second and third chance in case she misses a header, and to show a &quot;you lose&quot; message if she misses all three.  We will add the &quot;second and third chances&quot; in the next part. </span></p><h1><a name="castle-break-in-part-2" class="md-header-anchor"></a><span>Castle Break-In, Part 2</span></h1><h2><a name="multiple-lives" class="md-header-anchor"></a><span>Multiple lives</span></h2><p><span>In this game, the player will have three lives. One life is lost each time the soccer ball escapes the room. When all lives are lost, the game ends.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Inside the </span><code>constructor()</code><span> method of the </span><code>Princess</code><span> class definition, create a custom property called </span><code>lives</code><span> and set its value equal to 3.</span></p></li></ul><p><span>There is a </span><code>Sprite</code><span> method called </span><code>handleFirstGameLoop()</code><span> that is called by sgc on the first game loop that this sprite is active in the game.  The baseline </span><code>Sprite</code><span> class implementation does nothing.  We will override this method in our derived class (</span><code>Princess</code><span>) so that it will create a text area for displaying the number of lives remaining.</span></p><p><span>As it happens, there is a </span><code>game</code><span> method that does this.  It is called </span><code>createTextArea(x, y)</code><span>, where x and y define the coordinates for the upper left corner of the text box.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Inside the </span><code>Princess</code><span> class definition, define a </span><code>handleFirstGameLoop()</code><span> method with the following lines:</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">// Set up a text area to display the number of lives remaining.</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">this</span>.<span class="cm-property">livesDisplay</span> <span class="cm-operator">=</span> <span class="cm-variable">game</span>.<span class="cm-property">createTextArea</span>(<span class="cm-operator">**</span><span class="cm-variable">PUT</span> <span class="cm-variable">YOUR</span> <span class="cm-variable">VALUE</span> <span class="cm-variable">FOR</span> <span class="cm-variable">X</span> <span class="cm-variable">HERE</span><span class="cm-operator">**</span>, <span class="cm-number">20</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">this</span>.<span class="cm-property">updateLivesDisplay</span>();</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><span>In place of </span><strong><span>PUT YOUR VALUE OF X HERE</span></strong><span>, pick a value that is three soccer ball widths to the </span><em><span>left</span></em><span> of the </span><em><span>right</span></em><span> edge of the display (HINT: use </span><code>game.displayWidth</code><span>).  The last line calls a custom method we have not defined yet.  We will now.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Still inside the </span><code>Princess</code><span> class definition, define a custom method called </span><code>updateLivesDisplay()</code><span> that contains the following line of code:</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">game</span>.<span class="cm-property">writeToTextArea</span>(<span class="cm-keyword">this</span>.<span class="cm-property">livesDisplay</span>, <span class="cm-string">"Lives = "</span> <span class="cm-operator">+</span> <span class="cm-keyword">this</span>.<span class="cm-property">lives</span>);</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The first argument of the method is the variable that refers to the text area object, and the second argument is the string of text to put there.</span></p><p><span>Perhaps you are thinking to yourself, &quot;Why didn&#39;t we just put that line inside the </span><code>handleFirstGameLoop()</code><span> method??&quot;  The reason is that we will want to update the lives display several times throughout the game, not just on the first pass through the game loop, which means we would have to reiterate that line somewhere else in the program.  Remember we want to </span><em><span>reuse</span></em><span> our code whenever possible to avoid repeating ourselves and complicating the task of troubleshooting and maintenance.  I know ... I am repeating myself.  Perhaps I should take my own advice and write a method to remind you to reuse your code!  </span><code>tutorial.reduceReuseRecycle() {// Reminder to reuse code instead of repeating it}</code></p><h2><a name="dropping-the-ball" class="md-header-anchor"></a><span>Dropping the ball</span></h2><p><span>If the ball leaves play, we should delete the sprite to avoid memory leaks, and decrement the life counter by one.  First let&#39;s create a custom method in the </span><code>Princess</code><span> class that decrements the life counter and gives us a new ball until we run out of lives.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the </span><code>Princess</code><span> class definition, define a custom method called </span><code>loseALife()</code><span> that does the following:</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Decrements the value of </span><code>this.lives</code><span> by 1.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Calls </span><code>this.updateLivesDisplay()</code><span>.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Checks to see if </span><code>this.lives</code><span> is greater than zero.  If it is, create an new anonymous instance of the </span><code>Ball</code><span> class.  If not, end the game with the following message: </span><code>game.end(&#39;The mysterious stranger has escaped\nPrincess Ann for now!\n\nBetter luck next time.&#39;</code></p></li></ul></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the </span><code>Ball</code><span> class definition, define a </span><code>handleBoundaryContact()</code><span> method that:</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Calls </span><code>game.removeSprite(this)</code><span> to delete the ball in play</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Calls  </span><code>ann.loseALife()</code><span> </span></p></li></ul></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run your game and verify that the lives are being properly updated and the game doesn&#39;t end until the princess misses three headers.</span></p></li></ul><p><span>We will add some blocks to the game in part 3.</span></p><p><span>If you haven&#39;t done so already, please read </span><a href='http://computationaltales.blogspot.com/2011/06/variable-initialization-in-busy.html'><span>Variable Initialization in Busy Kitchens</span></a><span>. </span></p><h1><a name="castle-break-in-part-3" class="md-header-anchor"></a><span>Castle Break-In, Part 3</span></h1><p><span>Next, you will create the magic stone blocks that the stranger has placed in Princess Ann&#39;s way.  We will make several different types, but they will be more alike than different.  This could be an ideal time to use inheritance!  Let&#39;s start by making the parent </span><code>Block</code><span> class (which is itself a child of the </span><code>Sprite</code><span> class).</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a class called </span><code>Block</code><span> derived from the </span><code>Sprite</code><span> class.  </span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define a constructor method of this class that accepts two arguments (x and y) and does the following upon creation of each instance of the class:</span></p></li><li><span>Sets its x and y properties equal to the values in the passed arguments (i.e. </span><code>this.x = x;</code><span> etc.)</span></li><li><span>Gives it a name.</span></li><li><span>Gives it the </span><code>block1.png</code><span> image file</span></li><li><span>Sets the </span><code>accelerateOnBounce</code><span> property to </span><code>false</code><span>.</span></li></ul><p><span>(Did you remember to do the thing I said I wasn&#39;t going to remind you to do anymore?)</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Outside the class definition, create an anonymous instance of </span><code>Block</code><span> located at (x,y) = (400, 200).</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run your game and make sure you have a block in front of the castle gate.  It doesn&#39;t do anything ... yet.</span></p></li></ul><h2><a name="for-loops" class="md-header-anchor"></a><code>For</code><span> loops</span></h2><p><span>Let&#39;s say we want to create many of these blocks to make the game more interesting.  We could write a series of </span><code>new Block()</code><span> statements but there is a more efficient and elegant way: with a loop!  This is probably tied for </span><strong><span>the</span></strong><span> most powerful programming technique you will learn (along with conditional statements)</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Read </span><a href='http://computationaltales.blogspot.com/2011/03/loops-and-making-horseshoe.html'><span>Loops and Making Horseshoes</span></a></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Read </span><a href=''><span>W3Schools article on </span><code>for</code><span> syntax in javascript</span></a></p></li></ul><p><span>Now let&#39;s use a </span><code>for</code><span> loop to automate the process of adding a row of blocks.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Replace the line you just wrote that creates </span><em><span>one</span></em><span> anonymous block with the following </span><code>for</code><span> loop that creates multiple blocks:</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">5</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">new</span> <span class="cm-variable">Block</span>(<span class="cm-number">200</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">48</span>, <span class="cm-number">200</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 69px;"></div><div class="CodeMirror-gutters" style="display: none; height: 69px;"></div></div></div></pre><p><span>The </span><code>i++</code><span> in statement 3 is a short-hand way of writing</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>; &nbsp; &nbsp; <span class="cm-comment">// increment the value of i by 1</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The </span><code>new Block()</code><span> command is executed 5 times:</span></p><ul><li><span>One the first run through the loop, </span><span>		</span><span>i = 0 and the </span><code>x</code><span> position of the block is 200 + 0(48) = 200</span></li><li><span>One the second run through the loop,    i = 1 and the </span><code>x</code><span> position of the block is 200 + 1(48) = 248</span></li><li><span>One the third run through the loop,        i = 2 and the </span><code>x</code><span> position of the block is 200 + 2(48) = 296</span></li><li><span>One the fourth run through the loop,     i = 3 and the </span><code>x</code><span> position of the block is 200 + 3(48) = 344</span></li><li><span>One the fifth run through the loop,         i = 4 and the </span><code>x</code><span> position of the block is 200 + 4(48) = 392</span></li><li><span>One the sixth attempt,                               i = 5 and conditional in statement 2 fails so the loop terminates</span></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run your game and test to see if you have a row of 5 blocks running in front of the castle gate.  </span></p></li></ul><h2><a name="static-variables-for-the-win" class="md-header-anchor"></a><span>Static variables for the win</span></h2><p><span>The object of our game will be to eliminate all the blocks of a certain kind, not just the ones in front of the gate.  In order to know if we have eliminated all of them, we have to count how many we have made, and subtract one from this number every time a block is smashed.  To keep track of this we will need a so-called </span><strong><span>static</span></strong><span> variable associated with the </span><code>Block</code><span> </span><em><span>class</span></em><span>, not just a specific instance of that class.  To implement static variables in JavaScript we use the class name as the object identifier instead of the keyword </span><code>this</code><span> which refers to a specific instance of the class.  For example:  </span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Outside all of the class definitions, create a variable called </span><code>Block.blocksToDestroy</code><span> and set its value to zero.  </span><strong><span>Make sure you do this before the </span><code>for</code><span> loop that generates all the blocks!</span></strong></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Add this line to the </span><code>constructor()</code><span> method of the </span><code>Block</code><span> class</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang=""><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Block.blocksToDestroy = Block.blocksToDestroy + 1;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Now every instance of the class will modify this variable when the object is created.</span></p><p><span>Next we need to define a collision handling method for the </span><code>Block</code><span> class.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the </span><code>Block</code><span> class definition, define a new method called </span><code>handleCollision()</code><span> that does the following:</span></p></li><li><span>Deletes </span><code>this</code><span> sprite using the </span><code>game.removeSprite()</code><span> method.  (</span><em><span>HINT: pass </span><code>this</code><span> to the method by putting it in the argument list</span></em><span>)</span></li><li><span>Decrements the value of </span><code>Block.blocksToDestroy</code><span> by 1.</span></li><li><span>Checks to see if </span><code>Block.blocksToDestroy</code><span> is less than or equal to zero.  If it is, end the game with the following message:  (</span><em><span>HINT: pass this message to the </span><code>game.end()</code><span> method</span></em><span>)</span></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">'Congratulations!\n\nPrincess Ann can continue her pursuit\nof the mysterious stranger!'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><span>Return </span><code>true</code><span>. Make sure this happens whether or not </span><code>Block.blocksToDestroy</code><span> is less than or equal to zero! (i.e. put it outside the </span><code>if</code><span> block)  The method should return </span><code>true</code><span>if a bounce is desired, and it is - we want the ball to bounce off the block.  There is no way you would know this without looking at the </span><a href='https://csci110.github.io/sgc/'><span>sgc documentation</span></a><span>.</span></li></ul><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run the game and test that you get the congratulatory message after destroying all the blocks.  (you may wish to decrease the number of blocks for testing purposes).  You should have the beginning of a &quot;breakout&quot; style game, where the ball destroys the blocks that it hits, but also bounces from the impact.</span></p></li></ul><h2><a name="using-derived-classes-children-to-add-more-blocks" class="md-header-anchor"></a><span>Using derived classes (children) to add more blocks</span></h2><p><span>Before you put very many blocks into the room, you will add some variety. There will be two more kinds of block.  They will be </span><em><span>mostly</span></em><span> like the first block but different in minor ways (like the houses in the 3 little pigs example).  An elegant way to implement this is with </span><em><span>children</span></em><span> of the parent class.  We&#39;ve had some practice with this already, since all of our classes have been children of the </span><code>Sprite</code><span> class.  We will use the derived block classes, which are themselves derived from the </span><code>Sprite</code><span> class, to review the concepts of inheritance, overriding, and polymorphism.</span></p><p><span>Somewhere </span><em><span>after</span></em><span> you declare the </span><code>Block.blocksToDestroy</code><span> static variable:</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define an </span><code>ExtraLifeBlock</code><span> class which are derived from the </span><code>Block</code><span> class.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create an instance of the </span><code>ExtraLifeBlock</code><span> class at (x,y) = (200, 250).  </span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Define another child of the </span><code>Block</code><span> class called </span><code>ExtraBallBlock</code><span> which is just like the first one.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create an instance of the </span><code>ExtraBallBlock</code><span> class at (x,y) = (300, 250). </span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run your game and observe what happens when the ball strikes an instance of </span><code>ExtraLifeBlock</code><span> or </span><code>ExtraBallBlock</code><span>.</span></p></li></ul><p><span>Did you notice that they behave exactly like the parent </span><code>Block</code><span> instances -- and have all the properties and methods of </span><code>Block</code><span> like the image file  and the collision handler?  And we did this without repeating any code!  </span></p><h2><a name="inheriting-behavior" class="md-header-anchor"></a><span>Inheriting behavior</span></h2><p><span>Even though there is no programming for </span><code>ExtraLifeBlock</code><span>and </span><code>ExtraBallBlock</code><span>, the associated objects behave just like </span><code>Block</code><span> objects.</span></p><p><span>Why? A child (</span><code>ExtraLifeBlock</code><span> or </span><code>ExtraBallBlock</code><span>) &quot;inherits&quot; behavior from its parent (</span><code>Block</code><span>). The destroy-when-hit behavior is defined in the parent, but the child inherits this and behaves in the same way. (In programming, children inherit from parents, but parents never inherit from children.)</span></p><p><span>Also because of the parent/child relationship, an </span><code>ExtraLifeBlock</code><span> instance is a special kind of </span><code>Block</code><span> instance. And an </span><code>ExtraBallBlock</code><span> instance is a special kind of </span><code>Block</code><span> instance. Our class collision handler  defines behavior that causes the block to be removed when the ball hits it. This will also apply when the ball collides with instances of </span><code>ExtraLifeBlock</code><span> or </span><code>ExtraBallBlock</code><span>, because these are a kind of </span><code>Block</code><span>.</span></p><p><span>Parents help you to follow an important programming guideline: &quot;Don&#39;t repeat yourself.&quot; Using inheritance, you do not have to define the same actions in all three types of blocks. You also don&#39;t need to do more collision rule programming for each type of block object.</span></p><h2><a name="overriding-the-parents-behavior" class="md-header-anchor"></a><em><span>Overriding</span></em><span> the parent&#39;s behavior</span></h2><p><span>When a child matures, some of his or her behavior is different from the parents&#39;.</span></p><p><span>The same is true with object programming. There is no sense in creating a child object that behaves exactly like the parent.</span></p><p><span>Right now, all three types of block have identical behavior and appearance. Let&#39;s start by defining some new properties and behavior for </span><code>ExtraLifeBlock</code><span>. The ball should still bounce against it. However, it will not be destroyed; it will remain in place. Each time the ball strikes it, the player earns an additional life.  And to distinguish it from the parent block, let&#39;s give it a different image file.  But we need to be careful here.  The parent class constructor accepts two arguments (</span><code>x</code><span> and </span><code>y</code><span>).  This means we will need to have these arguments in the constructor of the child class too, and pass those to the parent class constructor by putting them in the argument list for the </span><code>super()</code><span> method, like this:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">ExtraLifeBlock</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Block</span> {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-property">constructor</span>(<span class="cm-def">x</span>, <span class="cm-def">y</span>) {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">super</span>(<span class="cm-variable-2">x</span>, <span class="cm-variable-2">y</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-meta">...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">} &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 138px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the constructor definition for the </span><code>ExtraLifeBlock</code><span> class:</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Set the image file to </span><code>&#39;block2.png&#39;</code><span>.  </span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Decrement the value of </span><code>Block.blocksToDestroy</code><span> by 1.  We do this because the blocks are indestructible, so we don&#39;t want them to count against us to meet the win condition.</span></p></li></ul></li></ul><p><span>Each </span><code>ExtraLifeBlock</code><span> instance is already inheriting a collision handler called </span><code>handleCollision()</code><span> from its parent class, </span><code>Block</code><span>. By re-defining that event in the child, we will &quot;override&quot; the parent behavior.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the class definition for </span><code>ExtraLifeBlock</code><span>, define a new </span><code>handleCollision()</code><span> method that calls </span><code>ann.addALife()</code><span> and returns </span><code>true</code><span>.   </span></p></li></ul><p><span>Note that this </span><em><span>overrides</span></em><span> (replaces) the parent class </span><code>handleCollision()</code><span> method for each instance of </span><code>ExtraLifeBlock</code><span>.  We haven&#39;t yet defined </span><code>ann.addALife()</code><span>.  We will do that now.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the </span><code>Princess</code><span> class definition, define an </span><code>addALife()</code><span> method that does the following:</span></p></li><li><span>Increments the value of </span><code>this.lives</code><span> by 1</span></li><li><span>Calls </span><code>this.updateLivesDisplay()</code></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run your game and test that the </span><code>ExtraLifeBlock</code><span> instance behaves as expected.</span></p></li></ul><p><span>The instance of </span><code>ExtraLifeBlock</code><span> acts almost exactly like an instance of the parent </span><code>Block</code><span> class, but it used a different collision handler defined in the child object. This is an example of </span><em><span>polymorphism</span></em><span>.</span></p><p><span>&quot;Polymorphism&quot; comes from Greek roots that mean &quot;having many forms&quot;. Here, this means that it&#39;s possible for a block to be an instance of </span><code>ExtraLifeBlock</code><span> and also to be an instance of </span><code>Block</code><span>, the parent.</span></p><p><strong><span>Polymorphism</span></strong><span>:</span></p><p><em><span>A feature of object-oriented programming that treats instances differently depending on their most specific object. In particular, allowing child objects to define their own specific behavior for some operations, while continuing to inherit parent behavior for other operations.</span></em></p><p><span>Now for something new: expanding our use of the </span><code>super()</code><span> method.  It&#39;s not just for constructors!</span></p><h2><a name="adding-to-the-parents-behavior" class="md-header-anchor"></a><em><span>Adding</span></em><span> to the parent&#39;s behavior</span></h2><p><span>Suppose you want </span><code>ExtraBallBlock</code><span> to behave differently, too. It will still do everything the parent does: the ball should bounce against it, and the block should be destroyed. But </span><em><span>in addition</span></em><span>, a second soccer ball will be created, to add interest to the game play.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the constructor definition for the </span><code>ExtraBallBlock</code><span> class, set the image file to </span><code>&#39;block3.png&#39;</code><span>.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Override the  </span><code>handleCollision()</code><span> method of the </span><code>ExtraBallBlock</code><span> class like this:</span></p></li></ul><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre>x</pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">handleCollision</span>() {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">super</span>.<span class="cm-property">handleCollision</span>(); <span class="cm-comment">// call function in superclass</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">new</span> <span class="cm-variable">Ball</span>(); <span class="cm-comment">// extend superclass behavior</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 115px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p><span>The first command, </span><code>super.handleCollision();</code><span>,  calls the same event in the parent class. If you stopped here, you would get exactly the same behavior as you had before overriding the parent&#39;s behavior. But the goal is to </span><em><span>add</span></em><span> to that behavior, so we add some additional code to the function definition; in this case, creating a new instance of the </span><code>Ball</code><span> class.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run the game and test for the expected behavior. When the ball strikes an instance of </span><code>ExtraBallBlock</code><span>, the block should be destroyed and an additional soccer ball should appear.</span></p></li></ul><h3><a name="removing-the-penalty-for-losing-the-extra-balls" class="md-header-anchor"></a><span>Removing the penalty for losing the &#39;extra&#39; balls</span></h3><p><span>There is a small problem with this programming. Each time a soccer ball leaves the room, the player loses a life. The extra soccer balls are intended as a fun and useful &quot;bonus&quot; only. As long as the player keeps one or more balls in the air, there should be no penalty.</span></p><p><span>You will now modify things so that the player loses a life only when all soccer balls have left the room.</span></p><ul><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Outside the class definitions, but </span><em><span>before</span></em><span> you create an object in the </span><code>Ball</code><span> class, initialize a new </span><em><span>static</span></em><span> variable called </span><code>Ball.ballsInPlay</code><span> and set its value to zero.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the constructor method definition of the  </span><code>Ball</code><span> class, add a line to the  to increment the value of </span><code>Ball.ballsInPlay</code><span> by 1.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>In the class definition for </span><code>Ball</code><span>, modify the </span><code>handleBoundaryContact()</code><span> method definition to decrement the value of </span><code>Ball.ballsInPlay</code><span> by 1, and then only call the </span><code>ann.loseALife()</code><span> method </span><em><span>if</span></em><span> </span><code>Ball.ballsInPlay</code><span> is equal to zero.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Run the game to verify that everything is working correctly.</span></p><h2><a name="wrapping-up" class="md-header-anchor"></a><span>Wrapping up</span></h2><p><span>One final point: this game&#39;s level of interest and challenge depends not only on the programming, but also on the arrangement of blocks in the room. Experiment until you find a good balance.  Challenge yourself to use </span><code>for</code><span> loops to create rows or columns of blocks. </span></p><p><span>If you find it too difficult to catch the balls when they are first created, consider modifying the speed of the Princess.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>When you are satisfied with the playability of your game, submit your assignment on Sakai by linking the url of your repl.</span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Use Question Set 4 to review and evaluate your mastery of new concepts. </span></p><h2><a name="break-in-project" class="md-header-anchor"></a><span>Break-In Project</span></h2></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Create a copy of your </span><code>.js</code><span> and </span><code>.html</code><span> files.  Modify the copied version of your Castle Break-In game to add two or more classes derived from the </span><code>Block</code><span> class.  Have each derived class provide a unique benefit, power-up or penalty to the player.  </span></p></li><li class='md-task-list-item task-list-item task-list-not-done' ><input type='checkbox' /><p><span>Submit your project by linking the url of your repl on Sakai.</span></p></li></ul></div>
</body>
</html>